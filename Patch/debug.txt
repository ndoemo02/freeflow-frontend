
ğŸš€ Booting FreeFlow Serverless...
ğŸ§  ENV OK
ğŸ”‘ SUPABASE_URL: âœ…
ğŸ”‘ OPENAI_API_KEY: âœ…
ğŸ§  FreeFlow Brain running locally on http://localhost:3000
GET /api/health 200 154 - 556.673 ms
GET /api/health 200 154 - 243.319 ms
GET /api/health 200 154 - 236.196 ms
GET /api/health 200 154 - 261.925 ms
GET /api/health 200 154 - 236.667 ms
GET /api/health 200 154 - 246.306 ms
GET /api/health 200 154 - 237.714 ms
GET /api/health 200 154 - 235.958 ms
GET /api/health 200 154 - 238.046 ms
GET /api/health 200 154 - 224.515 ms
GET /api/health 200 154 - 235.600 ms
GET /api/health 200 154 - 473.536 ms
GET /api/health 200 154 - 254.002 ms
GET /api/health 200 154 - 234.447 ms
GET /api/health 200 154 - 229.618 ms
GET /api/health 200 154 - 230.218 ms
âœ… Supabase client initialized (singleton mode)
[brainRouter] ğŸš€ Handler called
[Supabase] Creating client with URL: https://ezemaacyyvbpjlagchds.supabase.co
ğŸ§  [DEBUG] Handler called with: {
  sessionId: 'session-1765704807460',
  text: 'PokaÅ¼ miejsca w Piekarach',
  method: 'POST',
  body: {
    text: 'PokaÅ¼ miejsca w Piekarach',
    sessionId: 'session-1765704807460',
    lat: 52.2297,
    lng: 21.0122,
    includeTTS: false
  },
  hasText: true,
  textLength: 25
}
ğŸ§  [DEBUG] Current session state: {
  sessionId: 'session-1765704807460',
  session: {
    expectedContext: 'neutral',
    lastIntent: null,
    lastRestaurant: null,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: null,
    lastMenu: [],
    locationOverride: null,
    history: []
  },
  hasExpectedContext: true,
  expectedContextValue: 'neutral',
  hasLastRestaurant: false,
  lastRestaurantName: undefined,
  hasLastLocation: false,
  lastLocation: undefined,
  hasPendingOrder: false,
  lastIntent: null,
  sessionKeys: [
    'expectedContext',
    'lastIntent',
    'lastRestaurant',
    'lastRestaurantsList',
    'lastRestaurants',
    'lastRestaurantsTimestamp',
    'lastMenu',
    'locationOverride',
    'history'
  ]
}
ğŸ§­ GeoContext Layer activated for: "Piekary"
ğŸ—ºï¸ Found 9 restaurants in "Piekary"
ğŸ’¾ Cache SAVED for location: "Piekary"
âœ… GeoContext: 9 restaurants found in "Piekary" â€” asking for confirmation
POST /api/brain 200 4057 - 872.068 ms
GET /api/health 200 154 - 232.205 ms
GET /api/health 200 154 - 238.701 ms
GET /api/health 200 154 - 247.699 ms
GET /api/health 200 154 - 240.748 ms
GET /api/health 200 154 - 228.003 ms
GET /api/health 200 154 - 248.567 ms
[brainRouter] ğŸš€ Handler called
ğŸ§  [DEBUG] Handler called with: {
  sessionId: 'session-1765704807460',
  text: 'PokaÅ¼ restauracje w Piekarach ÅšlÄ…skich',
  method: 'POST',
  body: {
    text: 'PokaÅ¼ restauracje w Piekarach ÅšlÄ…skich',
    sessionId: 'session-1765704807460',
    lat: 52.2297,
    lng: 21.0122,
    includeTTS: false
  },
  hasText: true,
  textLength: 38
}
ğŸ§  [DEBUG] Current session state: {
  sessionId: 'session-1765704807460',
  session: {
    expectedContext: 'confirm_show_restaurants_city',
    lastIntent: 'find_nearby',
    lastRestaurant: null,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: null,
    lastMenu: [],
    locationOverride: null,
    history: [],
    locationCache: { piekary_all: [Object] },
    last_location: 'Piekary',
    lastUpdated: 1765708054017,
    last_restaurants_list: [
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object]
    ]
  },
  hasExpectedContext: true,
  expectedContextValue: 'confirm_show_restaurants_city',
  hasLastRestaurant: false,
  lastRestaurantName: undefined,
  hasLastLocation: true,
  lastLocation: 'Piekary',
  hasPendingOrder: false,
  lastIntent: 'find_nearby',
  sessionKeys: [
    'expectedContext',
    'lastIntent',
    'lastRestaurant',
    'lastRestaurantsList',
    'lastRestaurants',
    'lastRestaurantsTimestamp',
    'lastMenu',
    'locationOverride',
    'history',
    'locationCache',
    'last_location',
    'lastUpdated',
    'last_restaurants_list'
  ]
}
ğŸ§­ GeoContext Layer activated for: "Piekary ÅšlÄ…skie"
ğŸ—ºï¸ Found 9 restaurants in "Piekary ÅšlÄ…skie"
ğŸ’¾ Cache SAVED for location: "Piekary ÅšlÄ…skie"
âœ… GeoContext: 9 restaurants found in "Piekary ÅšlÄ…skie" â€” asking for confirmation
POST /api/brain 200 5842 - 485.532 ms
GET /api/health 200 154 - 573.360 ms
GET /api/health 200 154 - 240.985 ms
GET /api/health 200 154 - 224.416 ms
GET /api/health 200 154 - 243.385 ms
GET /api/health 200 154 - 236.149 ms
GET /api/health 200 154 - 234.317 ms
GET /api/health 200 154 - 246.410 ms
GET /api/health 200 154 - 247.633 ms
[brainRouter] ğŸš€ Handler called
ğŸ§  [DEBUG] Handler called with: {
  sessionId: 'session-1765704807460',
  text: 'co polecisz najwyÅ¼ej w pobliÅ¼u',
  method: 'POST',
  body: {
    text: 'co polecisz najwyÅ¼ej w pobliÅ¼u',
    sessionId: 'session-1765704807460',
    lat: 52.2297,
    lng: 21.0122,
    includeTTS: false
  },
  hasText: true,
  textLength: 30
}
ğŸ§  [DEBUG] Current session state: {
  sessionId: 'session-1765704807460',
  session: {
    expectedContext: 'confirm_show_restaurants_city',
    lastIntent: 'find_nearby',
    lastRestaurant: null,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: null,
    lastMenu: [],
    locationOverride: null,
    history: [],
    locationCache: { piekary_all: [Object], 'piekary Å›lÄ…skie_all': [Object] },
    last_location: 'Piekary ÅšlÄ…skie',
    lastUpdated: 1765708065965,
    last_restaurants_list: [
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object]
    ]
  },
  hasExpectedContext: true,
  expectedContextValue: 'confirm_show_restaurants_city',
  hasLastRestaurant: false,
  lastRestaurantName: undefined,
  hasLastLocation: true,
  lastLocation: 'Piekary ÅšlÄ…skie',
  hasPendingOrder: false,
  lastIntent: 'find_nearby',
  sessionKeys: [
    'expectedContext',
    'lastIntent',
    'lastRestaurant',
    'lastRestaurantsList',
    'lastRestaurants',
    'lastRestaurantsTimestamp',
    'lastMenu',
    'locationOverride',
    'history',
    'locationCache',
    'last_location',
    'lastUpdated',
    'last_restaurants_list'
  ]
}
[brainRouter] ğŸ§  Calling detectIntent with: {
  text: 'co polecisz najwyÅ¼ej w pobliÅ¼u',
  sessionId: 'session-1765704807460'
}
[brainRouter] ğŸ§  Current session: {
  expectedContext: 'confirm_show_restaurants_city',
  lastIntent: 'find_nearby',
  lastRestaurant: null,
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: null,
  lastMenu: [],
  locationOverride: null,
  history: [],
  locationCache: {
    piekary_all: { data: [Array], timestamp: 1765708053780 },
    'piekary Å›lÄ…skie_all': { data: [Array], timestamp: 1765708065728 }
  },
  last_location: 'Piekary ÅšlÄ…skie',
  lastUpdated: 1765708065965,
  last_restaurants_list: [
    {
      id: '1fc1e782-bac6-47b2-978a-f6f2b38000cd',
      name: 'Restauracja Stara Kamienica',
      address: 'ul. Bytomska 61',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'Polska',
      lat: 50.3856,
      lng: 18.94886
    },
    {
      id: '4d27fbe3-20d0-4eb4-b003-1935be53af25',
      name: 'Rezydencja Luxury Hotel',
      address: 'ul. Stara 1',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'MiÄ™dzynarodowa',
      lat: 50.39352,
      lng: 18.94742
    },
    {
      id: '569a7d29-57be-4224-bdf3-09c483415cea',
      name: 'Klaps Burgers',
      address: 'ul. Piotra Skargi 15',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'AmerykaÅ„ska',
      lat: 50.38643,
      lng: 18.95422
    },
    {
      id: '70842598-1632-43f6-8015-706d5adf182f',
      name: 'Vien-Thien',
      address: 'ul. Diamentowa 4',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'Wietnamska',
      lat: 50.39883,
      lng: 18.95574
    },
    {
      id: '8b00b05e-72f7-4a5f-b50c-5630a75d6312',
      name: 'Bar Praha',
      address: 'ul. Bytomska 139',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'Czeska / Polska',
      lat: 50.38807,
      lng: 18.93657
    },
    {
      id: 'bd9f2244-7618-4071-aa96-52616a7b4c70',
      name: 'Callzone',
      address: 'ul. KsiÄ™dza Piotra Skargi 3',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'Pizzeria',
      lat: 50.38594,
      lng: 18.95647
    },
    {
      id: 'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8',
      name: 'DwÃ³r Hubertus',
      address: 'ul. InwalidÃ³w Wojennych 72',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'ÅšlÄ…ska / Europejska',
      lat: 50.39233,
      lng: 18.94243
    },
    {
      id: 'fc844513-2869-4f42-b04f-c21e1e4cceb7',
      name: 'Tasty King Kebab',
      address: 'ul. Bytomska 70',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'Kebab',
      lat: 50.38587,
      lng: 18.94712
    },
    {
      id: '83566974-1017-4408-90ee-2571ccc06978',
      name: 'Pizzeria Monte Carlo',
      address: 'Ul. StanisÅ‚awa Maczka 22',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: null,
      lat: null,
      lng: null
    }
  ]
}
ğŸ”¬ Starting Smart Intent Layer...
[intent-router] ğŸš€ detectIntent called with: { text: 'co polecisz najwyÅ¼ej w pobliÅ¼u', sessionId: undefined }
[intent-router] ğŸ” Starting early dish detection for text: co polecisz najwyÅ¼ej w pobliÅ¼u
[intent-router] ğŸ” Normalized text: co polecisz najwyÅ¼ej w pobliÅ¼u
[intent-router] ğŸ” Session restaurant: NONE
[intent-router] ğŸ” Restaurant indicators in text: true
[intent-router] ğŸ” Searching for restaurant in text (reason: no session restaurant)
[intent-router] ğŸ” Checking 9 restaurants for fuzzy match
[loadMenuCatalog] ğŸ” Session: default
[loadMenuCatalog] ğŸ” lastRestaurant: undefined
[loadMenuCatalog] ğŸ” lastId: undefined
[loadMenuCatalog] âš ï¸ Loading all menu items (no restaurant in session)
[loadMenuCatalog] âœ… Loaded 246 menu items from 9 restaurants
[loadMenuCatalog] âœ… Sample items: Pizza Å unkovÃ¡, Pizza Ekkluzivne, Pizza LÃ¡ska NebeskÃ¡
[intent-router] Catalog loaded: 246 items
[intent-router] ğŸ” Calling parseOrderItems...
[intent-router] ğŸ” Catalog items: Pizza Å unkovÃ¡, Pizza Ekkluzivne, Pizza LÃ¡ska NebeskÃ¡, Rumcajsowy Burger, Golonka confit, SaÅ‚atka z halloumi, Zupa pomidorowa, Kofola klasyczna, Hawajska, Coca-Cola, Coca-Cola Zero, Fanta PomaraÅ„czowa, Sprite, Coca-Cola, Fanta, Piwo Tyskie, Pizza Margherita 33cm, Pizza Pepperoni 33cm, Pizza Hawajska 33cm, Pizza Capricciosa 33cm, Pizza Vege 33cm, Bacon Burger, Better Than Drwal - WoÅ‚owina, Cheddar Burger, Vege Burger, Spicy Burger, Bowl Gyros-Halloumi, Bowl z DyniÄ…, Bowl Kurczak Zapiekany z Serem, Filet Grillowany, Pulled Pork Bowl Pikantny, Zapiekaniec, Cappy JabÅ‚ko, Krem z Cebuli i Czosnku, SaÅ‚atka Cezar Callzone, SaÅ‚atka Grillowany Kurczak, SaÅ‚atka Halloumi, SaÅ‚atka z Serem Camembert, SaÅ‚atka z Serem Feta, SaÅ‚atka z DyniÄ…, Szarlotka, Sernik z Musem Malinowym, Ciasto Marchewkowe, Pepsi 0.85L, Kawa Czarna, Kawa BiaÅ‚a, Flat White, Cappuccino, Latte, Sos Tzatziki, Sos Pikantny, Sos Jogurtowy, GÄ™sie Å¼oÅ‚Ä…dki, Camembert z Å¼urawinÄ…, Deska zakÄ…sek dla dwojga, Wodzionka, Å»ur Å›lÄ…ski w chlebie, Å»ur Å›lÄ…ski na talerzu, Krem borowikowy, Zupa pomidorowa, Barszcz z tortellini, Flaki z indyka, Burger woÅ‚owy z frytkami i surÃ³wkÄ…, Burger wegetariaÅ„ski z Camembertem, frytkami oraz zestawem surÃ³wek, Gyros z frytkami i tzatziki, Å»eberka wieprzowe z frytkami, Kotlety czopskie, Dzikie placki, WÄ…trÃ³bka drobiowa, Grillowany filet z kurczaka, Kurczak po parysku, Ä†wiartka kaczki, Rolada wieprzowa, Kotlet schabowy, PolÄ™dwica wieprzowa, Kotlet po szwajcarsku, Rolada woÅ‚owa, OzÃ³r woÅ‚owy, Miruna w panierce, Zupa z kaczki, Zupa Won Ton, Tagliatelle ze szpinakiem, suszonymi pomidorami i pÅ‚atkami migdaÅ‚Ã³w, RosÃ³Å‚ z makaronem, NaleÅ›niki z serem na sÅ‚odko z bitÄ… Å›mietanÄ…, Carbonara a'la Hubertus, Filet z Å‚ososia na szpinaku, Stek z halibuta smaÅ¼ony na maÅ›le, PstrÄ…g na zioÅ‚owo, Pierogi z miÄ™sem, Pierogi ruskie, Kluski z sosem pieczeniowym, SaÅ‚atka Hubertusa z pieczywem czosnkowym, SaÅ‚atka grecka z pieczywem czosnkowym, Kluski Å›lÄ…skie, Ziemniaki z wody, Bratkartoffel, Kapusta modra, Kapusta zasmaÅ¼ana, Nuggetsy z frytkami oraz surÃ³wkÄ… z marchewki, Cappy PomaraÅ„cza, Woda Mineralna, Tiramisu, Panna Cotta, Brownie, Lody waniliowe z sosem karmelowym, Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard, Zupa krabowa, Sajgonki 3 szt., Sajgonki z ryÅ¼em, Sajgonki z surÃ³wkÄ…, Sajgonki z ryÅ¼em i surÃ³wkÄ…, Pierogi Ho Cao z ryÅ¼em i surÃ³wkÄ…, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Krem z dyni z biaÅ‚Ä… czekoladÄ…, Siekany tatar z polÄ™dwicy woÅ‚owej, WÄ™dzony pstrÄ…g, Carpaccio z kaczki marynowanej w grzaÅ„cu, BUFFAL, Kartacze z dzikiem, SaÅ‚atka z dyniÄ… marynowanÄ… w musztardzie, Grzanka z krupniokiem, Tagliatelle z krewetkami, Makaron ryÅ¼owy z warzywami, Zupa dnia, RosÃ³Å‚ z makaronem, Tradycyjny schabowy, Schab po beskidzku, NaleÅ›nik z kurczakiem i warzywami, NaleÅ›nik ze szpinakiem i serem feta, Lody z gorÄ…cymi malinami i bitÄ… Å›mietanÄ…, Fondant czekoladowy z lodami i bitÄ… Å›mietanÄ…, Coca-Cola, Fanta, Sprite, Cappy (200 ml), Woda mineralna (330 ml), Filet z kurczaka tradycyjny (panierowany), Filet z kurczaka po hawajsku, Grillowany filet z kurczaka, Kroket (z kapustÄ… i grzybami/bÄ…dÅº z miÄ™sem) 1 szt., Placki ziemniaczane 4 szt., Kluski Å›lÄ…skie 7 szt., Rolada woÅ‚owa (na zamÃ³wienie), PieczeÅ„ wieprzowa, WÄ…trÃ³bka drobiowa, Gulasz wieprzowy po wÄ™giersku, Pierogi (ruskie lub z miÄ™sem) 6 szt., Jajecznica z 2 szt. jaj, Placki po wÄ™giersku z gulaszem wieprzowym, NaleÅ›nik z dÅ¼emem truskawkowym lub wiÅ›niowym, NaleÅ›nik z nutellÄ…, bananami, bitÄ… Å›mietanÄ…, Margherita, Capricciosa, Diavola, Quattro Formaggi, Vegetariana, Prosciutto e Funghi, Salami, Pollo, Spinaci, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, GÅ‚odzilla, Kosmiczne Jaja Standard, Zupa wietnamska, Zupa z kurczakiem, Zupa Å‚ajska, Pierogi SiuMai z ryÅ¼em i surÃ³wkÄ…, Kurczak z warzywami, Kurczak sÅ‚odko-kwaÅ›ny, Kurczak pikantny, Kurczak po chiÅ„sku, Kurczak po tajsku, Kurczak na gorÄ…cym pÃ³Å‚misku, Kurczak w cieÅ›cie sÅ‚odko-kwaÅ›ny, Kurczak w cieÅ›cie pikantny, Kurczak w cieÅ›cie curry, Kurczak w cieÅ›cie piÄ™ciu smakÃ³w, Wieprzowina z warzywami, Wieprzowina sÅ‚odko-kwaÅ›na, Wieprzowina pikantna, Wieprzowina Curry, Wieprzowina piÄ™ciu smakÃ³w, Wieprzowina po tajsku, WoÅ‚owina z warzywami, WoÅ‚owina pikantna, WoÅ‚owina Curry, WoÅ‚owina 5 smakÃ³w, WoÅ‚owina po tajsku, WoÅ‚owina na gorÄ…cym pÃ³Å‚misku, Kaczka z warzywami, Kaczka pikantna, Kaczka sÅ‚odko-kwaÅ›na, Kaczka po chiÅ„sku, Kaczka po tajsku, Kaczka na gorÄ…cym pÃ³Å‚misku, Krewetki z warzywami, Krewetki pikantne, Krewetki Curry, Krewetki po tajsku, Krewetki na gorÄ…cym pÃ³Å‚misku, Kalmary chrupiÄ…ce sÅ‚odko-kwaÅ›ne, Kalmary chrupiÄ…ce pikantne, Kalmary chrupiÄ…ce Curry, Kalmary chrupiÄ…ce w piÄ™ciu smakach, Kalmary po tajsku, Kalmary na gorÄ…cym pÃ³Å‚misku, Pita Rollo, Pita Rollo z serem, Pita Rollo same miÄ™so, Tortilla kebab, Tortilla kebab z serem, Kebab amerykaÅ„ski, Kebab box, Kebab box z serem, Nuggets box, Kebab talerz, Kebab w buÅ‚ce, Falafel, Frytki z serem, Frytki z Indii masala, SaÅ‚atka grecka, Sos, Baklava, Sok Cappy, Coca-Cola 0,85l, Coca-Cola 0,5l, Coca-Cola 0,3l, Pepsi / Mirinda / 7up, Monster Energy Drink, Ayran Turecki, Mango Sok, Oshee, Burn
[parseOrderItems] ğŸ“Š Summary:
  - requestedNames: []
  - availableNames: []
  - unavailableNames: []
  - matched.length: 0
  - clarifications.length: 0
[intent-router] âœ… Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "co polecisz najwyÅ¼ej w pobliÅ¼u"
  ],
  "needsClarification": true,
  "unknownItems": [
    {
      "name": "co polecisz najwyÅ¼ej w pobliÅ¼u",
      "reason": "no_alias_match"
    }
  ]
}
[intent-router] ğŸ” parsed.any = false
[intent-router] ğŸ” parsed.groups.length = 0
âš ï¸ Unavailable items detected: co polecisz najwyÅ¼ej w pobliÅ¼u in tym menu
ğŸ” Checking if text contains restaurant name (using cached list): "co polecisz najwyÅ¼ej w pobliÅ¼u"
ğŸ” Debug session updated: {
  intent: 'clarify_order',
  restaurant: 'tym menu',
  sessionId: null,
  confidence: 0.9
}
âœ… SmartIntent Resolved: clarify_order (0.90) via classic
ğŸ§  [DEBUG] Hybrid intent detection complete: {
  ruleIntent: 'clarify_order',
  ruleConfidence: 0.9,
  llmIntent: null,
  llmConfidence: 0,
  finalIntent: 'clarify_order',
  finalConfidence: 0.9,
  source: 'classic',
  hasRestaurant: false,
  restaurantName: undefined,
  hasParsedOrder: true,
  parsedOrderDetails: { any: false, groupsCount: 0, groups: [] }
}
ğŸ§  [DEBUG] Calling boostIntent with: {
  text: 'co polecisz najwyÅ¼ej w pobliÅ¼u',
  hybridIntent: 'clarify_order',
  confidence: 0.9,
  session: {
    expectedContext: 'confirm_show_restaurants_city',
    lastRestaurant: undefined,
    lastIntent: 'find_nearby'
  }
}
ğŸ§  [DEBUG] boostIntent result: {
  originalIntent: 'clarify_order',
  boostedIntent: 'co polecisz najwyÅ¼ej w pobliÅ¼u',
  isContextLocked: false
}
ğŸŒŸ SmartContext: intent changed from "clarify_order" â†’ "co polecisz najwyÅ¼ej w pobliÅ¼u"
GET /api/health 200 154 - 235.773 ms
ğŸ§  GPT Reasoner: {
  searchRestaurants: true,
  searchMenu: false,
  askClarification: false,
  completeOrder: false,
  reasoning: 'Wybrano searchRestaurants poniewaÅ¼ uÅ¼ytkownik prosi o rekomendacje restauracji w pobliÅ¼u, co odpowiada na jego zapytanie dotyczÄ…ce lokalnych opcji gastronomicznych.'
}
ğŸ“‹ Parsed: { dish: null, restaurant: null }
âœ… User confirmed seeing city restaurants
ğŸš€ RELOADED! show_city_results: displaying limited results from 9 found.
POST /api/brain 200 6422 - 5172.912 ms
âœ… Allowed origin: http://localhost:5173
[TTS] Generating: ZnalazÅ‚am 9. Oto top 3 propozycje w Piekary ÅšlÄ…skie:...
âœ… Using GOOGLE_APPLICATION_CREDENTIALS (local)
âœ… Google access token obtained successfully
ğŸ”Š Using Chirp HD TTS (pl-PL-Wavenet-A, MP3)
POST /api/tts 200 35136 - 2040.095 ms
GET /api/health 200 154 - 240.811 ms
âœ… Allowed origin: http://localhost:5173
[TTS] Generating: Restauracja Stara Kamienica. Polska....
âœ… Using GOOGLE_APPLICATION_CREDENTIALS (local)
âœ… Google access token obtained successfully
ğŸ”Š Using Chirp HD TTS (pl-PL-Wavenet-A, MP3)
GET /api/health 200 154 - 243.026 ms
POST /api/tts 200 23808 - 1389.317 ms
GET /api/health 200 154 - 233.749 ms
GET /api/health 200 154 - 235.049 ms
âœ… Allowed origin: http://localhost:5173
[TTS] Generating: Rezydencja Luxury Hotel. MiÄ™dzynarodowa....
âœ… Using GOOGLE_APPLICATION_CREDENTIALS (local)
âœ… Google access token obtained successfully
ğŸ”Š Using Chirp HD TTS (pl-PL-Wavenet-A, MP3)
POST /api/tts 200 25728 - 1286.676 ms
GET /api/health 200 154 - 235.747 ms
âœ… Allowed origin: http://localhost:5173
[TTS] Generating: Klaps Burgers. AmerykaÅ„ska....
âœ… Using GOOGLE_APPLICATION_CREDENTIALS (local)
âœ… Google access token obtained successfully
ğŸ”Š Using Chirp HD TTS (pl-PL-Wavenet-A, MP3)
POST /api/tts 200 19968 - 992.741 ms
GET /api/health 200 154 - 235.268 ms
GET /api/health 200 154 - 243.487 ms
[brainRouter] ğŸš€ Handler called
ğŸ§  [DEBUG] Handler called with: {
  sessionId: 'session-1765704807460',
  text: 'wybieram stare Kamienica',
  method: 'POST',
  body: {
    text: 'wybieram stare Kamienica',
    sessionId: 'session-1765704807460',
    lat: 52.2297,
    lng: 21.0122,
    includeTTS: false
  },
  hasText: true,
  textLength: 24
}
ğŸ§  [DEBUG] Current session state: {
  sessionId: 'session-1765704807460',
  session: {
    expectedContext: null,
    lastIntent: 'find_nearby',
    lastRestaurant: null,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: null,
    lastMenu: [],
    locationOverride: null,
    history: [],
    locationCache: { piekary_all: [Object], 'piekary Å›lÄ…skie_all': [Object] },
    last_location: 'Piekary ÅšlÄ…skie',
    lastUpdated: 1765708094812,
    last_restaurants_list: [
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object]
    ]
  },
  hasExpectedContext: false,
  expectedContextValue: null,
  hasLastRestaurant: false,
  lastRestaurantName: undefined,
  hasLastLocation: true,
  lastLocation: 'Piekary ÅšlÄ…skie',
  hasPendingOrder: false,
  lastIntent: 'find_nearby',
  sessionKeys: [
    'expectedContext',
    'lastIntent',
    'lastRestaurant',
    'lastRestaurantsList',
    'lastRestaurants',
    'lastRestaurantsTimestamp',
    'lastMenu',
    'locationOverride',
    'history',
    'locationCache',
    'last_location',
    'lastUpdated',
    'last_restaurants_list'
  ]
}
ğŸ§­ GeoContext Layer activated for: "Kamienica"
âš™ï¸ GeoContext: brak wynikÃ³w w "Kamienica"
âš™ï¸ GeoContext: brak wynikÃ³w w "Kamienica" â€” kontynuuj normalny flow
[brainRouter] ğŸ§  Calling detectIntent with: {
  text: 'wybieram stare Kamienica',
  sessionId: 'session-1765704807460'
}
[brainRouter] ğŸ§  Current session: {
  expectedContext: null,
  lastIntent: 'find_nearby',
  lastRestaurant: null,
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: null,
  lastMenu: [],
  locationOverride: null,
  history: [],
  locationCache: {
    piekary_all: { data: [Array], timestamp: 1765708053780 },
    'piekary Å›lÄ…skie_all': { data: [Array], timestamp: 1765708065728 }
  },
  last_location: 'Piekary ÅšlÄ…skie',
  lastUpdated: 1765708094812,
  last_restaurants_list: [
    {
      id: '1fc1e782-bac6-47b2-978a-f6f2b38000cd',
      name: 'Restauracja Stara Kamienica',
      address: 'ul. Bytomska 61',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'Polska',
      lat: 50.3856,
      lng: 18.94886
    },
    {
      id: '4d27fbe3-20d0-4eb4-b003-1935be53af25',
      name: 'Rezydencja Luxury Hotel',
      address: 'ul. Stara 1',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'MiÄ™dzynarodowa',
      lat: 50.39352,
      lng: 18.94742
    },
    {
      id: '569a7d29-57be-4224-bdf3-09c483415cea',
      name: 'Klaps Burgers',
      address: 'ul. Piotra Skargi 15',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'AmerykaÅ„ska',
      lat: 50.38643,
      lng: 18.95422
    },
    {
      id: '70842598-1632-43f6-8015-706d5adf182f',
      name: 'Vien-Thien',
      address: 'ul. Diamentowa 4',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'Wietnamska',
      lat: 50.39883,
      lng: 18.95574
    },
    {
      id: '8b00b05e-72f7-4a5f-b50c-5630a75d6312',
      name: 'Bar Praha',
      address: 'ul. Bytomska 139',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'Czeska / Polska',
      lat: 50.38807,
      lng: 18.93657
    },
    {
      id: 'bd9f2244-7618-4071-aa96-52616a7b4c70',
      name: 'Callzone',
      address: 'ul. KsiÄ™dza Piotra Skargi 3',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'Pizzeria',
      lat: 50.38594,
      lng: 18.95647
    },
    {
      id: 'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8',
      name: 'DwÃ³r Hubertus',
      address: 'ul. InwalidÃ³w Wojennych 72',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'ÅšlÄ…ska / Europejska',
      lat: 50.39233,
      lng: 18.94243
    },
    {
      id: 'fc844513-2869-4f42-b04f-c21e1e4cceb7',
      name: 'Tasty King Kebab',
      address: 'ul. Bytomska 70',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: 'Kebab',
      lat: 50.38587,
      lng: 18.94712
    },
    {
      id: '83566974-1017-4408-90ee-2571ccc06978',
      name: 'Pizzeria Monte Carlo',
      address: 'Ul. StanisÅ‚awa Maczka 22',
      city: 'Piekary ÅšlÄ…skie',
      cuisine_type: null,
      lat: null,
      lng: null
    }
  ]
}
ğŸ”¬ Starting Smart Intent Layer...
[intent-router] ğŸš€ detectIntent called with: { text: 'wybieram stare Kamienica', sessionId: undefined }
[intent-router] ğŸ” Starting early dish detection for text: wybieram stare Kamienica
[intent-router] ğŸ” Normalized text: wybieram stare kamienica
[intent-router] ğŸ” Session restaurant: NONE
[intent-router] ğŸ” Restaurant indicators in text: false
[intent-router] ğŸ” Searching for restaurant in text (reason: no session restaurant)
[intent-router] ğŸ” Checking 9 restaurants for fuzzy match
[intent-router] ğŸª Restaurant detected in text (fuzzy): Restauracja Stara Kamienica (matched: 2/3)
[loadMenuCatalog] ğŸ” Session: {
  lastRestaurant: {
    id: '1fc1e782-bac6-47b2-978a-f6f2b38000cd',
    name: 'Restauracja Stara Kamienica'
  }
}
[loadMenuCatalog] ğŸ” lastRestaurant: {
  id: '1fc1e782-bac6-47b2-978a-f6f2b38000cd',
  name: 'Restauracja Stara Kamienica'
}
[loadMenuCatalog] ğŸ” lastId: 1fc1e782-bac6-47b2-978a-f6f2b38000cd
[loadMenuCatalog] âœ… Loading menu for restaurant: 1fc1e782-bac6-47b2-978a-f6f2b38000cd (Restauracja Stara Kamienica)
[loadMenuCatalog] âœ… Loaded 25 menu items from 1 restaurants
[loadMenuCatalog] âœ… Sample items: Zupa dnia, RosÃ³Å‚ z makaronem, Tradycyjny schabowy
[intent-router] Catalog loaded: 25 items
[intent-router] ğŸ” Calling parseOrderItems...
[intent-router] ğŸ” Catalog items: Zupa dnia, RosÃ³Å‚ z makaronem, Tradycyjny schabowy, Schab po beskidzku, NaleÅ›nik z kurczakiem i warzywami, NaleÅ›nik ze szpinakiem i serem feta, Lody z gorÄ…cymi malinami i bitÄ… Å›mietanÄ…, Fondant czekoladowy z lodami i bitÄ… Å›mietanÄ…, Coca-Cola, Fanta, Sprite, Cappy (200 ml), Woda mineralna (330 ml), Filet z kurczaka tradycyjny (panierowany), Filet z kurczaka po hawajsku, Grillowany filet z kurczaka, Kroket (z kapustÄ… i grzybami/bÄ…dÅº z miÄ™sem) 1 szt., Placki ziemniaczane 4 szt., Kluski Å›lÄ…skie 7 szt., Rolada woÅ‚owa (na zamÃ³wienie), PieczeÅ„ wieprzowa, WÄ…trÃ³bka drobiowa, Gulasz wieprzowy po wÄ™giersku, Pierogi (ruskie lub z miÄ™sem) 6 szt., Jajecznica z 2 szt. jaj, Placki po wÄ™giersku z gulaszem wieprzowym, NaleÅ›nik z dÅ¼emem truskawkowym lub wiÅ›niowym, NaleÅ›nik z nutellÄ…, bananami, bitÄ… Å›mietanÄ…
[parseOrderItems] ğŸ“Š Summary:
  - requestedNames: []
  - availableNames: []
  - unavailableNames: []
  - matched.length: 0
  - clarifications.length: 0
[intent-router] âœ… Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "wybieram stare kamienica"
  ],
  "needsClarification": true,
  "unknownItems": [
    {
      "name": "wybieram stare kamienica",
      "reason": "no_alias_match"
    }
  ]
}
[intent-router] ğŸ” parsed.any = false
[intent-router] ğŸ” parsed.groups.length = 0
âš ï¸ Unavailable items detected: wybieram stare kamienica in tym menu
ğŸ” Checking if text contains restaurant name (using cached list): "wybieram stare kamienica"
âœ… Text contains restaurant name: Restauracja Stara Kamienica â€” skipping clarify_order
[intent-router] âŒ No dishes matched in catalog (parsed.any = false)
[intent-router] âŒ Continuing to KROK 4 (targetRestaurant check)...
GET /api/health 200 154 - 526.799 ms
[intent-router] ğŸ” KROK 4: Checking targetRestaurant: {
  id: '1fc1e782-bac6-47b2-978a-f6f2b38000cd',
  name: 'Restauracja Stara Kamienica'
}
[intent-router] ğŸª KROK 4: Restaurant found in early detection: Restauracja Stara Kamienica, checking keywords...
[intent-router] ğŸ” KROK 4: Lower text: "wybieram stare kamienica"
[intent-router] ğŸ” KROK 4: Menu keywords: [
  'menu',             'co moge zjesc',
  'co maja',          'pokaz menu',
  'pokaÅ¼ menu',       'co jest w menu',
  'dania',            'potrawy',
  'co serwuja',       'co podaja',
  'karta dan',        'karta daÅ„',
  'co jest dostepne', 'co dostepne',
  'co maja w menu'
]
[intent-router] ğŸ” KROK 4: Order keywords: [
  'zamow',
  'poprosze',
  'prosze',
  'chce zamowic',
  'zloz zamowienie',
  'zamowic cos',
  'dodaj do zamowienia',
  'zloz',
  'wybieram',
  'biore',
  'wezme'
]
[intent-router] âœ… Order keyword found, returning create_order
ğŸ” Debug session updated: {
  intent: 'create_order',
  restaurant: 'Restauracja Stara Kamienica',
  sessionId: null,
  confidence: 0.9
}
âœ… SmartIntent Resolved: confirm_order (0.90) via llm
ğŸ§  [DEBUG] Hybrid intent detection complete: {
  ruleIntent: 'confirm_order',
  ruleConfidence: 0.9,
  llmIntent: 'confirm_order',
  llmConfidence: 0.9,
  finalIntent: 'confirm_order',
  finalConfidence: 0.9,
  source: 'llm',
  hasRestaurant: true,
  restaurantName: 'Restauracja Stara Kamienica',
  hasParsedOrder: false,
  parsedOrderDetails: null
}
ğŸ§  [DEBUG] Calling boostIntent with: {
  text: 'wybieram stare Kamienica',
  hybridIntent: 'confirm_order',
  confidence: 0.9,
  session: {
    expectedContext: null,
    lastRestaurant: undefined,
    lastIntent: 'find_nearby'
  }
}
ğŸ§  [DEBUG] boostIntent result: {
  originalIntent: 'confirm_order',
  boostedIntent: 'wybieram stare Kamienica',
  isContextLocked: false
}
ğŸŒŸ SmartContext: intent changed from "confirm_order" â†’ "wybieram stare Kamienica"
GET /api/health 200 154 - 248.925 ms
ğŸ§  GPT Reasoner: {
  searchRestaurants: true,
  searchMenu: false,
  askClarification: false,
  completeOrder: false,
  reasoning: "Wybrano searchRestaurants poniewaÅ¼ uÅ¼ytkownik wybraÅ‚ restauracjÄ™ 'Stara Kamienica', co sugeruje potrzebÄ™ potwierdzenia dostÄ™pnoÅ›ci tej restauracji w wynikach wyszukiwania."
}
ğŸ“‹ Parsed: { dish: null, restaurant: null }
ğŸ§  find_nearby intent detected
ğŸ“ Detected location: Kamienica
ğŸ§­ GeoContext active: searching in "Kamienica"
âš™ï¸ GeoContext: brak wynikÃ³w w "Kamienica"
ğŸ’¬ Generating GPT reply for intent: find_nearby
âœ… Final response: intent=find_nearby, confidence=0.9, fallback=false
POST /api/brain 200 10293 - 9185.884 ms
âœ… Allowed origin: http://localhost:5173
[TTS] Generating: Niestety, nie znalazÅ‚am restauracji "Stara Kamienica" ani w jej okolicy....
âœ… Using GOOGLE_APPLICATION_CREDENTIALS (local)
âœ… Google access token obtained successfully
ğŸ”Š Using Chirp HD TTS (pl-PL-Wavenet-A, MP3)
POST /api/tts 200 43008 - 1885.570 ms
GET /api/health 200 154 - 280.155 ms
GET /api/health 200 154 - 237.236 ms
âœ… Allowed origin: http://localhost:5173
[TTS] Generating: Restauracja Stara Kamienica. Polska....
âœ… Using GOOGLE_APPLICATION_CREDENTIALS (local)
âœ… Google access token obtained successfully
ğŸ”Š Using Chirp HD TTS (pl-PL-Wavenet-A, MP3)
POST /api/tts 200 23808 - 873.162 ms
âœ… Allowed origin: http://localhost:5173
[TTS] Generating: Rezydencja Luxury Hotel. MiÄ™dzynarodowa....
âœ… Using GOOGLE_APPLICATION_CREDENTIALS (local)
âœ… Google access token obtained successfully
ğŸ”Š Using Chirp HD TTS (pl-PL-Wavenet-A, MP3)
POST /api/tts 200 25728 - 399.499 ms
GET /api/health 200 154 - 235.597 ms
âœ… Allowed origin: http://localhost:5173
[TTS] Generating: Klaps Burgers. AmerykaÅ„ska....
âœ… Using GOOGLE_APPLICATION_CREDENTIALS (local)
âœ… Google access token obtained successfully
ğŸ”Š Using Chirp HD TTS (pl-PL-Wavenet-A, MP3)
POST /api/tts 200 19968 - 475.948 ms
GET /api/health 200 154 - 246.100 ms